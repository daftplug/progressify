import{config as n}from"./frontend.js";import{p as e}from"./installPrompt-a4fbb5d8.js";import{i as t,g as i}from"./utils-b7f0f688.js";const{__:o}=wp.i18n;class l extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.styles=new Set}connectedCallback(){this.render(),this.handlePerformInstallation()}static async findFeedContainer(){const n=[".post-list",".posts",".post-loop",".blog-posts",".content-area",".site-main","#main","#content","main",".entry-content"],e=[".post",".entry",".article",".blog-post",".hentry","article"];let t=null;for(const e of n){const n=document.querySelector(e);if(n){t=n;break}}if(!t)return null;let i=null;for(const n of e){const e=t.querySelectorAll(n);if(e.length>0){i=e;break}}return{feedContainer:t,feedItems:i}}static async show(){let n=document.querySelector("pwa-install-overlay-in-feed");if(!n){var e;n=document.createElement("pwa-install-overlay-in-feed");const t=await this.findFeedContainer();if(t&&(null==(e=t.feedItems)?void 0:e.length)>=4){const e=t.feedItems[3],i=document.createElement("div");i.className="pwa-install-overlay-wrapper",i.appendChild(n),e.parentNode.insertBefore(i,e.nextSibling)}}return n}injectStyles(n){this.styles.add(n)}handlePerformInstallation(){const n=this.shadowRoot.querySelector(".in-feed-overlay-button_install");null==n||n.addEventListener("click",()=>{e()})}render(){var e,t,l,s,a;const r=null!=(e=n.jsVars.settings.webAppManifest.appIdentity.appName)?e:"",d=null!=(t=null==(l=n.jsVars.settings.webAppManifest)||null==(l=l.appearance)?void 0:l.themeColor)?t:"#000000",p=i(d),c=null!=(s=null==(a=n.jsVars.settings.installation)||null==(a=a.prompts)?void 0:a.text)?s:o("Install Web App",n.slug),f=n.jsVars.iconUrl?`<img class="in-feed-overlay-appinfo_icon" src="${n.jsVars.iconUrl}" alt="${r}" onerror="this.style.display='none'"/>`:"";this.injectStyles(`\n      .in-feed-overlay {\n        position: relative;\n        border-radius: 0.5rem;\n        padding: 1rem;\n        background-color: ${d};\n        color: ${p};\n        box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n        -webkit-transition: all 0.2s ease-out;\n        -o-transition: all 0.2s ease-out;\n        transition: all 0.2s ease-out;\n        overflow: hidden;\n        text-transform: none;\n      }\n\n      .in-feed-overlay-appinfo {\n        display: flex;\n        align-items: center;\n        gap: 0.75rem;\n        flex: 1;\n      }\n\n      .in-feed-overlay-appinfo_icon {\n        border-radius: 9999px;\n        border: 1px solid #e5e7eb;\n        flex-shrink: 0;\n        height: 50px;\n        width: 50px;\n        display: inline-block;\n      }\n\n      .in-feed-overlay-appinfo_texts {\n        flex: 1;\n        min-width: 0;\n      }\n\n      .in-feed-overlay-appinfo_title {\n        font-size: 0.875rem;\n        line-height: 1.25rem;\n        font-weight: 500;\n        color: ${p};\n        display: -webkit-box;\n        overflow: hidden;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 1;\n      }\n\n      .in-feed-overlay-appinfo_description {\n        font-size: 0.75rem;\n        line-height: 1rem;\n        font-weight: 400;\n        color: ${p}cc;\n        margin-top: 0.12rem;\n        display: -webkit-box;\n        overflow: hidden;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 2;\n      }\n\n      .in-feed-overlay-button_install {\n        display: block;\n        background-color: ${p};\n        color: ${d};\n        vertical-align: middle;\n        text-decoration: none;\n        font-size: 0.875rem;\n        line-height: 1.25rem;\n        font-weight: 600;\n        padding: 0.375rem 0.875rem;\n        margin-left: auto;\n        margin-top: 1rem;\n        border: none;\n        outline: none;\n        border-radius: 9999px;\n        cursor: pointer;\n      }\n    `);const m=Array.from(this.styles).join("\n");this.shadowRoot.innerHTML=`\n      <style>${m}</style>\n      <div class="in-feed-overlay">\n        <div class="in-feed-overlay-appinfo">\n          ${f}\n          <div class="in-feed-overlay-appinfo_texts">\n            <div class="in-feed-overlay-appinfo_title">${c}</div>\n            <div class="in-feed-overlay-appinfo_description">${o("Keep reading, even when you're on the train!",n.slug)}</div>\n          </div>\n        </div>\n        <button type="button" class="in-feed-overlay-button_install">\n          ${o("Install Now",n.slug)}\n        </button>\n      </div>\n    `}}async function s(){var e;const{device:i,platform:o}=n.jsVars.userData,s="on"===(null==(e=n.jsVars.settings.installation)||null==(e=e.prompts)?void 0:e.skipFirstVisit);!i.isSmartphone&&!i.isTablet||!o.isBrowser||o.isPwa||s&&!t()||(customElements.get("pwa-install-overlay-in-feed")||customElements.define("pwa-install-overlay-in-feed",l),l.show(),setTimeout(()=>{l.show()},1e3))}export{s as initInstallOverlayInFeed};
