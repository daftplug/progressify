import{config as n}from"./frontend.js";import{p as e}from"./installPrompt-a4fbb5d8.js";import{a as t,i as s,s as a,g as i}from"./utils-b7f0f688.js";const{__:o}=wp.i18n;class r extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.styles=new Set,this.displayDuration=7e3}connectedCallback(){this.render(),this.setupInstallHandler()}static show(){let e=document.querySelector("pwa-install-overlay-snackbar");return e||(e=document.createElement("pwa-install-overlay-snackbar"),n.daftplugFrontend.appendChild(e),requestAnimationFrame(()=>{e.shadowRoot.querySelector(".snackbar-overlay").classList.add("visible"),e.startProgressBar(),e.setupAutoHide()})),e}injectStyles(n){this.styles.add(n)}startProgressBar(){const n=this.shadowRoot.querySelector(".snackbar-overlay-progressbar_inner");n.style.width="100%",requestAnimationFrame(()=>{n.style.width="0%"})}setupAutoHide(){this._hideTimeout&&clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(()=>{const n=this.shadowRoot.querySelector(".snackbar-overlay");n.classList.remove("visible"),n.addEventListener("transitionend",()=>{this.remove()},{once:!0})},this.displayDuration)}setupInstallHandler(){this.shadowRoot.querySelector(".snackbar-overlay-button_install").addEventListener("click",()=>{e()})}render(){var e,t,s,a;const r=null!=(e=null==(t=n.jsVars.settings.webAppManifest)||null==(t=t.appearance)?void 0:t.themeColor)?e:"#000000",l=i(r),c=null!=(s=null==(a=n.jsVars.settings.installation)||null==(a=a.prompts)?void 0:a.text)?s:o("Install Web App",n.slug);this.injectStyles(`\n      .snackbar-overlay {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        gap: 1rem;\n        position: fixed;\n        right: 1rem;\n        left: 1rem;\n        bottom: 1rem;\n        border-radius: 0.5rem;\n        z-index: 99999;\n        padding: 1rem;\n        background-color: ${r};\n        color: ${l};\n        box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);\n        transition: all 0.2s ease-out;\n        opacity: 0;\n        visibility: hidden;\n        overflow: hidden;\n      }\n\n      .snackbar-overlay.visible {\n        opacity: 1;\n        visibility: visible;\n      }\n\n      .snackbar-overlay-appinfo_title {\n        font-size: 0.875rem;\n        line-height: 1.25rem;\n        font-weight: 500;\n        color: ${l};\n        display: -webkit-box;\n        overflow: hidden;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 1;\n      }\n\n      .snackbar-overlay-appinfo_description {\n        font-size: 0.75rem;\n        line-height: 1rem;\n        font-weight: 400;\n        color: ${l}cc;\n        margin-top: 0.12rem;\n        text-wrap: balance;\n        display: -webkit-box;\n        overflow: hidden;\n        -webkit-box-orient: vertical;\n        -webkit-line-clamp: 2;\n      }\n\n      .snackbar-overlay-button_install {\n        display: inline-block;\n        flex-shrink: 0;\n        background-color: ${l};\n        color: ${r};\n        vertical-align: middle;\n        text-decoration: none;\n        font-size: 0.875rem;\n        line-height: 1.25rem;\n        font-weight: 600;\n        padding: 0.375rem 0.875rem;\n        border: none;\n        outline: none;\n        border-radius: 9999px;\n        cursor: pointer;\n      }\n\n      .snackbar-overlay-progressbar {\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        width: 100%;\n        height: 0.25rem;\n        background-color: ${r};\n        overflow: hidden;\n      }\n\n      .snackbar-overlay-progressbar_inner {\n        width: 100%;\n        height: 100%;\n        background-color: ${l}80;\n        transition: width ${this.displayDuration}ms linear;\n      }\n    `);const d=Array.from(this.styles).join("\n");this.shadowRoot.innerHTML=`\n      <style>${d}</style>\n      <div class="snackbar-overlay">\n        <div class="snackbar-overlay-appinfo">\n          <div class="snackbar-overlay-appinfo_title">${c}</div>\n          <div class="snackbar-overlay-appinfo_description">${o("Installing uses no storage and offers a quick way back to our web app.",n.slug)}</div>\n        </div>\n        <button type="button" class="snackbar-overlay-button_install">\n          ${o("Install Now",n.slug)}\n        </button>\n        <div class="snackbar-overlay-progressbar">\n          <div class="snackbar-overlay-progressbar_inner"></div>\n        </div>\n      </div>\n    `}}async function l(){var e,i,o;let l=!1;const{device:c,platform:d}=n.jsVars.userData,p=c.isSmartphone||c.isTablet,b=d.isBrowser,u=d.isPwa,h=null!=(e=null==(i=n.jsVars.settings.installation)||null==(i=i.prompts)?void 0:i.timeout)?e:1,m="on"===(null==(o=n.jsVars.settings.installation)||null==(o=o.prompts)?void 0:o.skipFirstVisit),v=t("pwa_snackbar_overlay_shown");!p||!b||u||v||m&&!s()||(customElements.get("pwa-install-overlay-snackbar")||customElements.define("pwa-install-overlay-snackbar",r),window.addEventListener("scroll",()=>{l||window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100>=30&&(r.show(),l=!0,a("pwa_snackbar_overlay_shown","true",h))}))}export{l as initInstallOverlaySnackbar};
